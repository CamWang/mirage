<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据库 | Mirage Documents</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/mirage/assets/style.abb680c9.css">
    <link rel="modulepreload" href="/mirage/assets/Home.67a7102b.js">
    <link rel="modulepreload" href="/mirage/assets/app.feb34482.js">
    <link rel="modulepreload" href="/mirage/assets/develop_database.md.6eb2dd5b.lean.js">
    <link rel="modulepreload" href="/mirage/assets/app.feb34482.js">
    <meta name="twitter:title" content="数据库 | Mirage Documents">
    <meta property="og:title" content="数据库 | Mirage Documents">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-7161a24b><div class="sidebar-button" data-v-7161a24b><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/mirage/" aria-label="Mirage Documents, back to home" data-v-7161a24b data-v-4a583abe><!----> Mirage Documents</a><div class="flex-grow" data-v-7161a24b></div><div class="nav" data-v-7161a24b><nav class="nav-links" data-v-7161a24b data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/mirage/" data-v-641633f9>主页 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/mirage/guide/" data-v-641633f9>用户指南 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/mirage/develop/" data-v-641633f9>开发指南 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/CamWang/mirage" target="_blank" rel="noopener noreferrer" data-v-641633f9>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-6b49cdcd><nav class="nav-links nav" data-v-6b49cdcd data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/mirage/" data-v-641633f9>主页 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/mirage/guide/" data-v-641633f9>用户指南 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item" href="/mirage/develop/" data-v-641633f9>开发指南 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-641633f9><a class="item isExternal" href="https://github.com/CamWang/mirage" target="_blank" rel="noopener noreferrer" data-v-641633f9>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-641633f9><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-6b49cdcd><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/mirage/develop/">开发指南</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/mirage/develop/git">Git常用指令</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/mirage/develop/database">数据库</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#mongodb">MongoDB</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#数据库和集合">数据库和集合</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#文档-document">文档 Document</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mongodb-compass">MongoDB Compass</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mongoose">Mongoose</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#快速入门">快速入门</a><!----></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="数据库"><a class="header-anchor" href="#数据库" aria-hidden="true">#</a> 数据库</h1><p>Mirage使用NoSQL数据库MongoDB。</p><h2 id="mongodb"><a class="header-anchor" href="#mongodb" aria-hidden="true">#</a> MongoDB</h2><p>MongoDB是一个文档型NoSQL数据库，其使用一种改良过的JSON格式也就是BSON格式，作为数据存储方式。就像SQL数据一样，它也包含数据库服务器（Server）与驱动（Driver）两个主要的部分。数据库服务器负责数据的存储与查询等，驱动为各种语言开发一套访问数据库服务器的API。</p><h3 id="数据库和集合"><a class="header-anchor" href="#数据库和集合" aria-hidden="true">#</a> 数据库和集合</h3><p>MongoDB中储存的数据记录的单位是文档（Document），文档是以BSON格式存储的。相同类型的文档储存为集合（Collection），多个集合组成一个数据库（Database）。一个MongoDB实例可以有多个数据库。</p><h3 id="文档-document"><a class="header-anchor" href="#文档-document" aria-hidden="true">#</a> 文档 Document</h3><p>一个文档可以类比为关系型数据库中的一行记录，文档由多个键值对组成。文档的格式是类似于JSON的BSON。</p><div style="text-align:center;margin:20px;"><img src="/mirage/assets/document.c5eea892.svg" width="550"></div><p>文档的优势是：</p><ul><li>文档的数据类型与许多编程语言的原生类型更加接近</li><li>内嵌文档和数组减少了很多浪费资源的多表join</li><li>自由的表定义可以很自然的支持多态等情况</li></ul><p>下面是一个文档的例子：</p><div class="language-js"><pre><code><span class="token keyword">var</span> mydoc <span class="token operator">=</span> <span class="token punctuation">{</span>
  _id<span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5099803df3f4948bd2f98391&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span> first<span class="token operator">:</span> <span class="token string">&quot;Alan&quot;</span><span class="token punctuation">,</span> last<span class="token operator">:</span> <span class="token string">&quot;Turing&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  birth<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&#39;Jun 23, 1912&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  death<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&#39;Jun 07, 1954&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  contribs<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Turing machine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Turing test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Turingery&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  views <span class="token operator">:</span> <span class="token function">NumberLong</span><span class="token punctuation">(</span><span class="token number">1250000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上方文档每个键对应值的类型：</p><ul><li><code>_id</code>是MongoDB会默认为每个文档创建的键，它的类型是MongoDB特有的<code>ObjectId</code></li><li><code>name</code>的类型是内嵌文档，也就是说一个文档里可以有某个属性的值为另一个文档，这样就可以直接查到数据而非使用多表连接</li><li><code>birth</code>和<code>death</code>都是日期类型</li><li><code>contribs</code>的类型是字符串数组</li><li><code>views</code>的类型是<code>NumberLong </code></li></ul><p>文档内值的访问可以直接使用<code>.</code>来进行，例如：</p><ul><li>为了获取<code>_id</code>可以使用<code>data._id</code></li><li>为了获取<code>name</code>内的<code>first</code>可以使用<code>data.name.first</code></li><li>为了获取<code>contribs</code>的第三个元素可以使用<code>data.contribs.2</code></li></ul><p>文档有限制大小，BSON文档最大16MB，但是建议大于2M时可以考虑将较大字段分出去。</p><p>BSON支持的文档内值类型可以参考MongoDB的官方文档：<a href="https://docs.mongodb.com/manual/reference/bson-types/" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/manual/reference/bson-types/</a></p><h2 id="mongodb-compass"><a class="header-anchor" href="#mongodb-compass" aria-hidden="true">#</a> MongoDB Compass</h2><p>MongoDB Compass是MongoDB官方使用的数据库管理工具，方便用户使用图形界面对MongoDB数据进行查看和管理。<a href="https://docs.mongodb.com/compass/current/" target="_blank" rel="noopener noreferrer">官方文档</a></p><h2 id="mongoose"><a class="header-anchor" href="#mongoose" aria-hidden="true">#</a> Mongoose</h2><p>Mongoose是一个MongoDB的对象数据映射框架（ODM），虽然MongoDB的原生存储方式（BSON）已经十分接近JavaScript对象，但是仍有许多操作可以被简化。它管理数据之间的关系，提供数据验证，将MongoDB的对象形式转换为Node.js的对象形式。</p><h3 id="快速入门"><a class="header-anchor" href="#快速入门" aria-hidden="true">#</a> 快速入门</h3><p>下面是Mongoose基本使用的例子，摘取自Mongoose的官方文档Quick Start</p><h4 id="准备动作"><a class="header-anchor" href="#准备动作" aria-hidden="true">#</a> 准备动作</h4><p>首先要保证Node.js与MongoDB已经被正确的安装，然后使用npm安装Mongoose依赖。</p><div class="language-shell"><pre><code><span class="token function">npm</span> <span class="token function">install</span> --save mongoose
</code></pre></div><p>如果我们想保存所有小猫到MongoDB里，首先要做的是在项目中引入Mongoose依赖，并告诉Mongoose如何连接本机的MongoDB服务器。</p><div class="language-js"><pre><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://localhost:27017/test&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>由于数据库连接是异步的，所以我们为连接数据库过程的各个事件绑定处理器，来获取连接状态。如果你不想在连接后进行操作，那这一步大可省略</p><div class="language-js"><pre><code><span class="token keyword">const</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> <span class="token string">&#39;connection error:&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;open&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// we&#39;re connected!</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="操作数据"><a class="header-anchor" href="#操作数据" aria-hidden="true">#</a> 操作数据</h4><p>在Mongoose里，所有数据对象都是由Schema（一种类似于面向对象编程中接口的概念的东西）衍生而来。让我们定义一个Kitten小猫Schema。</p><div class="language-js"><pre><code><span class="token keyword">const</span> kittySchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> String<span class="token punctuation">,</span>
  color<span class="token operator">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>更多关于Mongoose Schema的内容，请参考Mongoose的Schema、SchemaType文档。</p></div><p>很明显，上面的小猫Schema具有name名字和color颜色两个属性，这将搭建MongoDB和JavaScript代码中对象的桥梁。然后我们在JavaScript代码中使用这个桥梁为模板，新建一个Model</p><div class="language-js"><pre><code><span class="token keyword">const</span> Kitten <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;Kitten&#39;</span><span class="token punctuation">,</span> kittySchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>更多关于Mongoose Model的内容，请参考Mongoose的Model文档。</p></div><p>Model类似于类的概念，我们接下来使用Model来创建真正具有数据的Document</p><div class="language-js"><pre><code><span class="token keyword">const</span> bill <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Kitten</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;Bill&#39;</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token string">&#39;orange&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bill<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#39;Bill&#39;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>更多关于Mongoose Document的内容，请参考Mongoose的Document、Subdocument文档。</p></div><p>此时，我们就可以调用<code>save()</code>方法来保存我们的小猫Bill了。调用<code>save()</code>方法将令Mongoose对MongoDB发出新建Kitten集合（Collection）指令并在该集合中写入一条Bill文档（Document）。<br> 从Kitten集合（在MongoDB的集合，是在Mongoose里的Model）内查找Bill，我们可以使用Model上的<code>find()</code>方法。</p><div class="language-js"><pre><code>Kitten<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;Bill&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>更多关于Mongoose数据查询内容，请参考Mongoose的Queries文档。</p></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/mirage/develop/git" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Git常用指令</span></a></div><div class="next" data-v-38ede35f><!----></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"7d9c3fd7\",\"develop_database.md\":\"6eb2dd5b\",\"develop_git.md\":\"1f5a24b0\",\"develop_index.md\":\"47e5904f\",\"guide_index.md\":\"51fc69ea\"}")</script>
    <script type="module" async src="/mirage/assets/app.feb34482.js"></script>
  </body>
</html>